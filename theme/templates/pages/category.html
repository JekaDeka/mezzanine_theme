{% extends "pages/page.html" %}
{% load mezzanine_tags shop_tags i18n theme_tags pages_tags static  %}

{% block breadcumbs_menu %}
{% shop_menu "pages/menus/breadcrumb.html" %}
{% endblock %}


{% block main_containter %}
<div class="container">
{% if sub_categories %}
	<div id="portfolio-wrapper">
	{% for category in sub_child_categories %}
		<div class="four columns portfolio-item custom_column
		{% if no_child %}{{category.title|hard_trim}}{% else %}{{category.parent.title|hard_trim}}{% endif %}">
			<figure>
				<div class="portfolio-holder">
					<a href="{{ category.get_absolute_url }}">
					{% if settings.SHOP_CATEGORY_USE_FEATURED_IMAGE %}
						{% if category.featured_image %}
							<img alt="" src="{{ MEDIA_URL }}{% thumbnail category.featured_image 280 280 %}"/>
						{% else %}
							{% with "23456"|make_list|random as rnd %}
							{% with 'images/product_category_0'|add:rnd|add:'.jpg' as img_path %}
							    <img src="{{ STATIC_URL }}{% thumbnail img_path 280 280 %}" alt="">
							{% endwith %}
							{% endwith %}
						{% endif %}
					{% else %}
						<img src="{{ STATIC_URL }}{% thumbnail 'images/titlebar_bg_01.jpg' 280 280 %}" alt="">
					{% endif %}
						<div class="hover-cover"></div>
						<div class="hover-icon"></div>
					</a>
				</div>
				<a href="{{ category.get_absolute_url }}">
					<section class="item-description">
						<span>{{ category.parent.title }}</span>
						<h5>{{ category.title|smart_truncate_chars:35 }}</h5>
					</section>
				</a>
			</figure>
		</div>
	{% endfor %}
	</div>
{% endif %} 
</div>
{{ block.super }}
{% endblock %}

{% block leftsidebar %}
<div class="four columns">
	<div class="widget margin-top-0">
		<h3 class="headline"> {% trans "Categories" %} </h3>
		<span class="line"></span><div class="clearfix"></div>
		{% shop_menu "pages/menus/shop_tree.html" %}
		<div class="clearfix"></div>
	</div>

	<!-- filters -->
<form method="GET">
	<div class="widget">
	    <h3 class="headline">Цена</h3><span class="line"></span>
	    <div class="clearfix"></div>
	    <div class="input_price">
	    	<span>от</span>
	    	<input class="" id="id_min_price" name="min_price" step="1" type="number" {% if request.GET.min_price %}value="{{ request.GET.min_price }}"{% endif %}>
	    </div><!-- -->
	    <div class="input_price">
	    	<span>до</span>
	    	<input class="" id="id_max_price" name="max_price" step="1" type="number" {% if request.GET.max_price %}value="{{ request.GET.max_price }}"{% endif %}>
	    </div>
	    
	</div>

	<div class="widget margin-top-10">
	    <h3 class="headline">Отобразить</h3><span class="line"></span>
	    <div class="clearfix"></div>
	    <label class="control control--checkbox">
	        <input {% if request.GET.region %}checked="checked" {% endif %} id="id_region" name="region" type="checkbox" value="{{ request.user.profile.region.id }}">
	        Товары из моего региона
	        <div class="control__indicator"></div>
	    </label>
	    {% for label, name, value in main_filters %}
	    <label class="control control--checkbox">
	        <input {% if name in request.GET %}checked="checked" {% endif %} id="id_{{name}}" name="{{name}}" type="checkbox" value="{{ value }}">{{ label }}
	        <div class="control__indicator"></div>
	    </label>
	    {% endfor %}
	    <div class="clearfix"></div>
	</div>

	<div class="widget margin-top-5">
	    <h3 class="headline">Доставка</h3><span class="line"></span>
	    <div class="clearfix"></div>
	    {% for label, name, value in delivery_filters %}
	    <label class="control control--checkbox">
	        <input {% if name in request.GET %}checked="checked" {% endif %} id="id_{{name}}" name="{{name}}" type="checkbox" value="{{ value }}">{{ label }}
	        <div class="control__indicator"></div>
	    </label>
	    {% endfor %}
	    <div class="clearfix"></div>
	</div>

	<div class="widget margin-top-5">
	    <h3 class="headline">Оплата</h3><span class="line"></span>
	    <div class="clearfix"></div>
	    {% for label, name, value in payment_filters %}
	    <label class="control control--checkbox">
	        <input {% if name in request.GET %}checked="checked" {% endif %} id="id_{{name}}" name="{{name}}" type="checkbox" value="{{ value }}">{{ label }}
	        <div class="control__indicator"></div>
	    </label>
	    {% endfor %}
	    <div class="clearfix"></div>
	</div>
	<input type="submit" class="button pull-right" value="Применить"></input>
</form>
</div>
{% endblock %}


{% block main %}
{% if true_products %}
	<div class="twelve columns">
		<form class="product-sorting" method="GET">
		        <select onchange="location.href = this[this.selectedIndex].value;" class="orderby" id="sorting-select">
		        {% for name, option in settings.SHOP_PRODUCT_SORT_OPTIONS %}
		        {% if "rating" not in option or settings.SHOP_USE_RATINGS %}
		        <option{% if option == products.sort_by %} selected{% endif %}
		            value="{{ category.get_absolute_url }}?sort={{ option }}{{ querystring }}">
		            {{ name }}
		        </option>
		        {% endif %}
		        {% endfor %}
		        </select>
		</form>
	</div>
	<div class="twelve columns products">
		{% for product in true_products %}
		<div class="four shop columns custom_column">
			<figure class="product">
				<div class="badges">
				{% if product.pre_order %}
					<div class="product-example">Для примера</div>
				{# {% else %} #}
					<!--<div class="product-ready">Готовый вариант</div>-->
				{% endif %}
				{% if product.on_custom_sale %}
					<div class="product-discnt">СКИДКА</div>
				{% endif %}
				</div>
				{% with product.images.all|slice:"2" as images %}
				<div class="mediaholder {% if not images or images.count == 1 %}no-anim{%endif%}">
				<a href="{{ product.get_absolute_url }}">
					{% if images %}
					<img alt="" src="{{ MEDIA_URL }}{% thumbnail images.0 250 330 %}">
						{% if product.image.count != 1 %}
						<div class="cover">
								<img alt="" src="{{ MEDIA_URL }}{% thumbnail images.1 300 380 %}">
						</div>
						{% endif %}
					{% else %}
					<img alt="" src="{{ STATIC_URL }}{% thumbnail 'images/no-image.jpg' 250 330 %}">
					{% endif %}
				</a>
				<a href="{{ product.get_absolute_url }}" class="product-button"><i class="fa fa-share"></i>Подробнее</a>
				</div>
				{% endwith %}
				<a href="{{ product.get_absolute_url }}">
					<section>
						<h5>{{ product.title|title|truncatechars:34 }}</h5>
						<a href="{{ product.user.shop.get_absolute_url }}" class="shopname">{{ product.user.shop.shopname }}</a>
						<!--<span class="product-category">
						</span>-->
						{% if product.on_custom_sale %}
							<span class="product-price-discount">{{ product.unit_price|rub_currency }}<i>{{ product.price|rub_currency }}</i></span>
						{% else %}
						<span class="product-price">{{ product.price|rub_currency }}</span>
						{% endif %}
					</section>
				</a>
			</figure>
		</div>
		{% endfor %}
		<div class="clearfix"></div>
		{% if true_products.paginator.count != 0 %}
			{% pagination_for true_products %}
		{% endif %}
	</div>
{% else %}
<div class="twelve columns">
	<section id="not-found">
        <p>Товаров по заданным критериям не найдено</p>
    </section>
</div>
{% endif %}
{% endblock %}